{% extends 'starsign/base.html' %}      
{% load static %}
{% block content %}
    <!-- Display the form for birth date submission -->
    <div class="form-group">
        <h1><p style="color: #ffa500">FAN ZONE</p> Find Your Star Sign and Get a Gift</h1>
        <hr>
        <form method="post" id="birth_date_form">
            {% csrf_token %}
            <div class="form-group" id="birth_date_input">
                <p style="font-size: 22px;">Enter your birth date:</p>
                {{ form.birth_date }}
                <p style="padding-top: 20px;">
                    <button type="button" class="btn btn-warning btn-lg" onclick="showMobileNumberInput()">Find My Star Sign</button>
                </p>
                <div id="message" style="color: red; display: none;"></div>
            </div>

            <!-- Place this where you want to show the star sign -->
            <div id="star_sign_result" style="display: none;">
                <h3>Your Star Sign: <span id="user_star_sign"></span></h3>
            </div>

            <!-- Initially hidden form for mobile number submission -->
            <div class="form-group" id="mobile_input" style="display:none;">
                {{ form.mobile_number }}
                <p style="padding-top: 20px;">
                    <button type="submit" class="btn btn-warning btn-lg">Claim My Gift</button>
                </p>
                <div id="mobile_number_message" style="color: red; display: none;"></div>  
            </div> 
        </form>
    </div>
    <script>
        function showMobileNumberInput() {
            var birthDateInput = document.querySelector("#birth_date_input input");
            var birthDateForm = document.getElementById("birth_date_form");
            var mobileInputSection = document.getElementById("mobile_input");
            var messageDiv = document.getElementById("message");
            var starSignDiv = document.getElementById("star_sign_result");
            var userStarSign = document.getElementById("user_star_sign");
    
            if (birthDateInput && birthDateInput.value) {
                // Prepare data for AJAX request
                var formData = new FormData(birthDateForm);
                formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
    
                // AJAX request to server to get star sign
                fetch("{% url 'find_star' %}", {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Display the star sign and show the mobile input section
                        userStarSign.textContent = data.star_sign;
                        starSignDiv.style.display = 'block';
                        mobileInputSection.style.display = 'block'; // Show mobile input section
                        birthDateForm.style.display = 'none'; // Optionally hide the birth date form
                    } else {
                        // Show error message if star sign can't be retrieved
                        messageDiv.textContent = 'Error: ' + data.error;
                        messageDiv.style.display = 'block';
                    }
                })
                .catch(error => {
                    // Handle any errors from the fetch request
                    console.error('Error:', error);
                    console.log(error)
                    messageDiv.textContent = 'An error occurred. Please try again.';
                    messageDiv.style.display = 'block';
                });
            } else {
                // Prompt user to enter birth date if it's missing
                messageDiv.textContent = "Please enter your birth date.";
                messageDiv.style.display = "block";
            }
        }
    </script>
    
    
{% endblock %}
